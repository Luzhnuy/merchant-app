<ion-content padding class="transparent">

  <div class="booking-header">
    <img src="./assets/img/Bookings.png">
  </div>

  <form
      (submit)="createOrder()"
      #form="ngForm"
      class="transparent"
  >

    <ion-card padding>

      <h1>Drop-off Details</h1>

      <div *ngIf="apiError">
        <small class="error">
          {{ apiError }}
        </small>
      </div>

      <div class="form-group">
        <label for="name">Dropoff Name:</label>
        <div class="input-group has-icon">
          <ion-icon name="person"></ion-icon>
          <input type="text"
                 class="form-control has-icon"
                 id="name"
                 placeholder="Name"
                 matInput
                 required
                 name="name"
                 #nameEl="ngModel"
                 autocomplete="NoAutocomplete"
                 [(ngModel)]="name"
                 [disabled]="!enabledBooking"
          >
        </div>
      </div>

      <div *ngIf="nameEl.invalid && (nameEl.dirty || nameEl.touched)">
        <small class="error">Please enter the name</small>
      </div>

      <div class="form-group">
        <label for="address">Dropoff Address:</label>
        <div class="input-group has-icon">
          <ion-icon name="pin"></ion-icon>
          <input
              type="text"
              class="form-control has-icon"
              id="address"
              placeholder="Address"
              matInput
              required
              name="address"
              autocomplete="NoAutocompleteAddress"
              ngx-google-places-autocomplete
              #addressEl="ngModel"
              [options]="placesOptions"
              (onAddressChange)="handleAddressChange($event)"
              [(ngModel)]="address"
              [disabled]="!enabledBooking"
          >
        </div>
      </div>

      <div *ngIf="addressInvalid && (addressEl.dirty || addressEl.touched)">
        <small class="error">SnapGrab does not yet service this destination. We will let you know when we
          expand into this area.</small>
      </div>

      <div class="form-group">
        <label for="zipcode">Dropoff Postal Code:</label>
        <div class="input-group has-icon">
          <input type="text"
                 class="form-control has-icon"
                 id="zipcode"
                 placeholder="Postal Code"
                 matInput
                 required
                 disabled
                 name="zipcode"
                 [(ngModel)]="zipcode"
          >
        </div>
      </div>

      <div class="form-group">
        <label for="phone">Mobile Phone:</label>
        <div class="input-group has-icon">
          <ion-icon name="call"></ion-icon>
          <input type="tel"
                 class="form-control has-icon"
                 id="phone"
                 placeholder=""
                 matInput
                 required
                 pattern="(\+\d{2}[ -]?)?((\d{3}-\d{3}-\d{4})|(\d{10})|(\d{3} \d{3} \d{4}))"
                 name="phone"
                 autocomplete="NoAutocomplete"
                 #phoneEl="ngModel"
                 [(ngModel)]="phone"
                 [disabled]="!enabledBooking"
          >
        </div>
      </div>

      <div *ngIf="phoneEl.invalid && (phoneEl.dirty || phoneEl.touched)">
        <small class="error">Please enter phone number in format:
          000-000-0000 or 000 000 0000 or 0000000000 or +00 000 000 0000, etc</small>
      </div>

    </ion-card>
    <ion-card padding>

      <h1>Additional Information</h1>

      <div class="form-group ion-margin-top">
        <label for="instruction">Instruction:</label>
        <div class="input-group has-icon">
          <ion-icon name="list-box"></ion-icon>
          <input type="text"
                 class="form-control has-icon"
                 id="instruction"
                 placeholder="Instruction eg. leave with doorman or suite 200 or app 2"
                 matInput
                 name="instruction"
                 [(ngModel)]="instruction"
                 [disabled]="!enabledBooking"
          >
        </div>
      </div>

      <ion-item>
        <!--<ion-label>Bring item back to shop (Add a reverse delivery from the dropoff location back to the shop)</ion-label>-->
        <ion-label>
          Bring item back to shop
          <ion-icon
              name="information-circle-outline"
              tooltip="Add a reverse delivery from the dropoff location back to the shop"
              positionV="bottom"
              positionH="left"
              event="click"
          ></ion-icon>
        </ion-label>
        <ion-toggle
            slot="end"
            name="bringBack"
            mode="ios"
            color="success"
            [(ngModel)]="bringBack"
            (ionChange)="recalculatePrices()"
            [disabled]="!enabledBooking"
        ></ion-toggle>
      </ion-item>

      <ion-item>
        <ion-label>
          Large Heavy Order
          <ion-icon
              name="information-circle-outline"
              tooltip="more than 3 bags, boxes, large items"
              positionV="bottom"
              positionH="left"
              event="click"
          ></ion-icon>
        </ion-label>
        <ion-toggle
            slot="end"
            name="largeOrder"
            mode="ios"
            color="success"
            [(ngModel)]="largeOrder"
            (ionChange)="recalculatePrices()"
            [disabled]="!enabledBooking"
        ></ion-toggle>
      </ion-item>

    </ion-card>
    <ion-card padding>

      <h1>Pick up Scheduler</h1>

      <p><b>Pick Up Time  (Please allow up to 60 minutes from scheduled pick up for completed delivery): </b></p>

      <ion-item>
        <ion-label>Date</ion-label>
        <ion-datetime
            displayFormat="YYYY-MM-DD"
            picker-format="YYYY MM DD"
            [min]="minYear"
            [max]="maxYear"
            (ionChange)="dateChanged($event)"
            [value]="date"
            [ngClass]="{'sg-invalid': dateInvalid}"
            name="date"
            [disabled]="!enabledBooking"
        ></ion-datetime>
      </ion-item>

      <ion-item>
        <ion-label>Time</ion-label>
        <ion-datetime
            display-format="HH:mm"
            picker-format="HH mm"
            hourValues="10,11,12,13,14,15,16,17,18,19,20,21,22"
            (ionChange)="timeChanged($event)"
            [value]="time"
            name="time"
            [disabled]="!enabledBooking"
        ></ion-datetime>
      </ion-item>
      <div>&nbsp;
        <small class="error" *ngIf="dateInvalid">Please, choose delivery date and time in the future</small>
        <br *ngIf="dateInvalid && timeInvalid"/>
        <small class="error" *ngIf="timeInvalid">Please, choose delivery time between 10:00 and 22:00</small>
      </div>

    </ion-card>

    <ion-card
        padding
        class="confirmation-block"
    >

      <h1>Confirm and Book</h1>
      <p>
        A detailed confirmation receipt will be sent to your e-mail
      </p>

      <ion-grid
          no-padding
          margin-vertical
          *ngIf="extras"
      >
        <ion-row no-padding>
          <ion-col no-padding sizeXs="9" sizeMd="7" sizeLg="5" sizeXl="3">
            Base Fare
            <ion-chip
                *ngIf="extras.surgeTime"
                color="tertiary"
                tooltip="Prices are slightly higher for your scheduled delivery time du to high demand or difficult driving conditions."
                positionV="bottom"
                positionH="left"
                event="click"
            >
<!--              <ion-icon name="flash-outline"></ion-icon>-->
              <img src="assets/icon/flash-outline.svg" class="surge-price-img">
              <ion-label color="dark">Surge Time</ion-label>
            </ion-chip>
          </ion-col>
          <ion-col no-padding size="2" sizeXs="3">
            CA${{ extras.baseFare | number:'1.2-2' }}
          </ion-col>
        </ion-row>
        <ion-row no-padding>
          <ion-col no-padding sizeXs="9" sizeMd="7" sizeLg="5" sizeXl="3">
            Distance
            <ion-icon
                name="information-circle"
                color="medium"
                tooltip="Your base fare includes delivery up to 3km away from your pick-up location. Each additional km is billed CA$1.50 per KM up to a maximum of 20km."
                positionV="bottom"
                positionH="left"
                event="click"
            ></ion-icon>
          </ion-col>
          <ion-col no-padding size="2" sizeXs="3">
            CA${{ extras.distanceFare | number:'1.2-2' }}
          </ion-col>
        </ion-row>
        <ion-row no-padding *ngIf="extras && extras.largeOrderFare">
          <ion-col no-padding sizeXs="9" sizeMd="7" sizeLg="5" sizeXl="3">
            Large Order Fare
          </ion-col>
          <ion-col no-padding size="2" sizeXs="3">
            CA${{ extras.largeOrderFare | number:'1.2-2' }}
          </ion-col>
        </ion-row>
        <ion-row no-padding>
          <ion-col no-padding sizeXs="9" sizeMd="7" sizeLg="5" sizeXl="3">
            TPS
          </ion-col>
          <ion-col no-padding size="2" sizeXs="3">
            CA${{ order.metadata.tps | number:'1.2-2' }}
          </ion-col>
        </ion-row>
        <ion-row no-padding>
          <ion-col no-padding sizeXs="9" sizeMd="7" sizeLg="5" sizeXl="3">
            TVQ
          </ion-col>
          <ion-col no-padding size="2" sizeXs="3">
            CA${{ order.metadata.tvq | number:'1.2-2' }}
          </ion-col>
        </ion-row>
        <ion-row no-padding>
          <ion-col no-padding sizeXs="9" sizeMd="7" sizeLg="5" sizeXl="3">
            <b>
              Total charged
              <span *ngIf="card">
                to
                <img [src]="'./assets/img/' + getSrc()" class="brand-image"/>
                {{ card.last4 }}
              </span>
            </b>
          </ion-col>
          <ion-col no-padding size="2" sizeXs="3">
            CA${{ order.metadata.totalAmount | number:'1.2-2' }}
          </ion-col>
        </ion-row>
      </ion-grid>

      <div class="input-group">
        <ion-button
            type="submit"
            class="submit-button"
            [disabled]="!enabledBooking || form.invalid || addressInvalid || timeInvalid || dateInvalid"
        >
          <ion-icon slot="start" name="send"></ion-icon>
          Place delivery
        </ion-button>
      </div>

    </ion-card>

  </form>


</ion-content>
